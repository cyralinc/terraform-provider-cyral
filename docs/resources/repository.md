# cyral_repository (Resource)

Manages [repositories](https://cyral.com/docs/manage-repositories/repo-track).

See also [Cyral Repository Configuration Module](https://github.com/cyralinc/terraform-cyral-repository-config).
This module provides the repository configuration options as shown in Cyral UI.

-> **NOTE** Import ID syntax is `{repository_id}`.

## Example Usage

```terraform
### Minimal Repository
resource "cyral_repository" "minimal_repo" {
    type = "mongodb"
    name = "minimal_repo"

    repo_node {
        name = "node-1"
        host = "mongodb.cyral.com"
        port = 27017
    }

    mongodb_settings {
      server_type = "standalone"
    }
}

### Repository with Connection Draining and Labels
resource "cyral_repository" "repo_with_conn_draining" {
    type = "mongodb"
    name = "repo_with_conn_draining"
    labels = [ "single-node", "us-east-1" ]

    repo_node {
        name = "node-1"
        host = "mongodb.cyral.com"
        port = 27017
    }

    connection_draining {
      auto = true
      wait_time = 30
    }

    mongodb_settings {
      server_type = "standalone"
    }
}

### Multi-Node MongoDB Repository with Replicaset
resource "cyral_repository" "multi_node_mongo_repo" {
    type = "mongodb"
    name = "multi_node_mongo_repo"
    labels = [ "multi-node", "us-east-2" ]

    repo_node {
        name = "node-1"
        host = "mongodb-node1.cyral.com"
        port = 27017
    }

    repo_node {
        name = "node-2"
        host = "mongodb-node2.cyral.com"
        port = 27017
    }

    repo_node {
        name = "node-3"
        dynamic = true
    }

    mongodb_settings {
      replica_set_name = "some-replica-set"
      server_type = "replicaset"
    }
}
```

<!-- schema generated by tfplugindocs -->

## Schema

### Required

- `name` (String) Repository name that will be used internally in the control plane (ex: `your_repo_name`).
- `repo_node` (Block List, Min: 1) List of nodes for this repository. (see [below for nested schema](#nestedblock--repo_node))
- `type` (String) Repository type. List of supported types:
  - `denodo`
  - `dremio`
  - `dynamodb`
  - `dynamodbstreams`
  - `galera`
  - `mariadb`
  - `mongodb`
  - `mysql`
  - `oracle`
  - `postgresql`
  - `redshift`
  - `s3`
  - `snowflake`
  - `sqlserver`

### Optional

- `connection_draining` (Block Set, Max: 1) Parameters related to connection draining. (see [below for nested schema](#nestedblock--connection_draining))
- `labels` (List of String) Labels enable you to categorize your repository.
- `mongodb_settings` (Block Set, Max: 1) Parameters related to MongoDB repositories. (see [below for nested schema](#nestedblock--mongodb_settings))

### Read-Only

- `id` (String) ID of this resource in Cyral environment.

<a id="nestedblock--repo_node"></a>

### Nested Schema for `repo_node`

Optional:

- `dynamic` (Boolean) _Only supported for MongoDB in cluster configurations._
  Indicates if the node is dynamically discovered, meaning that the sidecar will query the cluster to get the topology information and discover the hosts of the remaining nodes. If set to `true`, `host` and `port` must be empty. A node that does not declare this field is considered `static`.
  The following conditions apply:
  - The total number of declared `repo_node` blocks must match the actual number of nodes in the cluster.
  - If there are static nodes in the configuration, they must be declared before all dynamic nodes.
  - See the MongoDB-specific configuration in the [mongodb_settings](#nested-schema-for-mongodb_settings).
- `host` (String) Repo node host (ex: `somerepo.cyral.com`). Can be empty if node is dynamic.
- `name` (String) Name of the repo node.
- `port` (Number) Repository access port (ex: `3306`). Can be empty if node is dynamic.

<a id="nestedblock--connection_draining"></a>

### Nested Schema for `connection_draining`

Optional:

- `auto` (Boolean) Whether connections should be drained automatically after a listener dies.
- `wait_time` (Number) Seconds to wait to let connections drain before starting to kill all the connections, if auto is set to true.

<a id="nestedblock--mongodb_settings"></a>

### Nested Schema for `mongodb_settings`

Required:

- `server_type` (String) Type of the MongoDB server. Allowed values:
  - `replicaset`
  - `standalone`
  - `sharded`.
    The following conditions apply:
  - If `server_type=standalone`, then only one `repo_node` block can be declared and it must be static. See `dynamic`. - If `server_type=sharded` and the a `srv_record_name` is provided, then all `repo_node` blocks must be declared dynamic, otherwise all of them must be static. See `dynamic`.

Optional:

- `replica_set_name` (String) Name of the replica set, if applicable.
- `srv_record_name` (String) Name of a DNS SRV record which contains cluster topology details. The following conditions apply:
  - If `srv_record_name` is specified, then all `repo_node` blocks can be declared `dynamic=true`.
  - If `srv_record_name` is _not_ specified, then at _least one_ node must have `repo_node.host` and `repo_node.port`.
