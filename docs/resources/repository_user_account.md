# cyral_repository_user_account (Resource)

~> **Warning** When referring to the user account ID in other resources, like `cyral_repository_access_rules` for example,
use the read-only attribute `user_account_id` instead of `id`.

-> Import ID syntax is `{repository_id}/{user_account_id}`, where `{user_account_id}` is the ID of the user
account in the Cyral Control Plane.

## Example Usage

```terraform
# Test Repo to use in examples.
resource "cyral_repository" "tf_test_repo" {
  name = "tf_test_repo"
  type = "postgresql"

  repo_node {
    host = "postgresql.mycompany.com"
    port = 5432
  }
}


# cyral_repository_user_account with auth scheme aws_iam
resource "cyral_repository_user_account" "aws_iam" {
  name         = "hbf_aws_iam"
  repository_id = cyral_repository.tf_test_repo.id

  auth_scheme {
    aws_iam {
      role_arn = "role_arn"
    }
  }
}

# cyral_repository_user_account with auth scheme aws_secrets will be created
resource "cyral_repository_user_account" "aws_secrets" {
  name          = "hbf_aws_secrets"
  repository_id = cyral_repository.tf_test_repo.id

  auth_scheme {
    aws_secrets_manager {
      secret_arn = "secret_arn"
    }
  }
}

# cyral_repository_user_account with auth scheme env_var will be created
resource "cyral_repository_user_account" "env_var" {
  name          = "hbf_env_var"
  repository_id = cyral_repository.tf_test_repo.id

  auth_scheme {
    environment_variable {
      variable_name = "some-env-var"
    }
  }
}

# cyral_repository_user_account with auth scheme gcp_secrets will be created
resource "cyral_repository_user_account" "gcp_secrets" {
  name          = "hbf_gcp_secrets"
  repository_id = cyral_repository.tf_test_repo.id

  auth_scheme {
    gcp_secrets_manager {
      secret_name = "secret_name"
    }
  }
}

# cyral_repository_user_account with auth scheme azure_key_vault will be created
resource "cyral_repository_user_account" "azure_key_vault" {
  name          = "hbf_azure_key_vault"
  repository_id = cyral_repository.tf_test_repo.id

  auth_scheme {
    azure_key_vault {
      secret_url = "https://vaultName.vault.azure.net/secrets/secretName"
    }
  }
}

# cyral_repository_user_account with auth scheme hashicorp will be created
resource "cyral_repository_user_account" "hashicorp" {
  name          = "hbf_hashicorp"
  repository_id = cyral_repository.tf_test_repo.id

  auth_scheme {
    hashicorp_vault {
      path = "some-path"
      is_dynamic_user_account = false
    }
  }
}

# cyral_repository_user_account with auth scheme kubernetes will be created
resource "cyral_repository_user_account" "kubernetes" {
  name          = "hbf_kubernetes"
  repository_id = cyral_repository.tf_test_repo.id

  auth_scheme {
    kubernetes_secret {
      secret_key  = "secret_key"
      secret_name = "secret_name"
    }
  }
}
```

<!-- schema generated by tfplugindocs -->

## Schema

### Required

-   `auth_scheme` (Block List, Min: 1, Max: 1) Credential option. List of supported types:
    -   `aws_iam`
    -   `aws_secrets_manager`
    -   `cyral_storage`
    -   `hashicorp_vault`
    -   `environment_variable`
    -   `kubernetes_secret`
    -   `gcp_secrets_manager`
    -   `azure_key_vault` (see [below for nested schema](#nestedblock--auth_scheme))
-   `name` (String) The name of the User Account.
-   `repository_id` (String) ID of the repository.

### Optional

-   `approval_config` (Block Set, Max: 1) Configurations related to Approvals. (see [below for nested schema](#nestedblock--approval_config))
-   `auth_database_name` (String) The database name that this User Account is scoped to, for `cyral_repository` types that support multiple databases.

### Read-Only

-   `id` (String) Terraform ID of this resource. Follows syntax `{repository_id}/{user_account_id}`
-   `user_account_id` (String) ID of the user account.

<a id="nestedblock--auth_scheme"></a>

### Nested Schema for `auth_scheme`

Optional:

-   `aws_iam` (Block Set, Max: 1) Credential option to set the repository user account from AWS IAM. (see [below for nested schema](#nestedblock--auth_scheme--aws_iam))
-   `aws_secrets_manager` (Block Set, Max: 1) Credential option to set the repository user account from AWS Secrets Manager. (see [below for nested schema](#nestedblock--auth_scheme--aws_secrets_manager))
-   `azure_key_vault` (Block Set, Max: 1) Credential option to set the repository user account from Azure Key Vault. (see [below for nested schema](#nestedblock--auth_scheme--azure_key_vault))
-   `cyral_storage` (Block Set, Max: 1) Credential option to set the repository user account from Cyral Storage. (see [below for nested schema](#nestedblock--auth_scheme--cyral_storage))
-   `environment_variable` (Block Set, Max: 1) Credential option to set the repository user account from Environment Variable. (see [below for nested schema](#nestedblock--auth_scheme--environment_variable))
-   `gcp_secrets_manager` (Block Set, Max: 1) Credential option to set the repository user account from GCP Secrets Manager. (see [below for nested schema](#nestedblock--auth_scheme--gcp_secrets_manager))
-   `hashicorp_vault` (Block Set, Max: 1) Credential option to set the repository user account from Hashicorp Vault. (see [below for nested schema](#nestedblock--auth_scheme--hashicorp_vault))
-   `kubernetes_secret` (Block Set, Max: 1) Credential option to set the repository user account from a Kubernetes secret. (see [below for nested schema](#nestedblock--auth_scheme--kubernetes_secret))

<a id="nestedblock--auth_scheme--aws_iam"></a>

### Nested Schema for `auth_scheme.aws_iam`

Required:

-   `role_arn` (String) The AWS IAM roleARN to gain access to the database.

Optional:

-   `authenticate_as_iam_user` (Boolean) Boolean flag which indicates whether to access as an IAM user or IAM role on the Redshift cluster. By default, this is false, which means this governs access for a user.

<a id="nestedblock--auth_scheme--aws_secrets_manager"></a>

### Nested Schema for `auth_scheme.aws_secrets_manager`

Required:

-   `secret_arn` (String) The AWS Secrets Manager secretARN to gain access to the database.

<a id="nestedblock--auth_scheme--azure_key_vault"></a>

### Nested Schema for `auth_scheme.azure_key_vault`

Required:

-   `secret_url` (String) The URL of the secret in the Azure Key Vault.

<a id="nestedblock--auth_scheme--cyral_storage"></a>

### Nested Schema for `auth_scheme.cyral_storage`

Required:

-   `password` (String, Sensitive) The Cyral Storage password to gain access to the database.

<a id="nestedblock--auth_scheme--environment_variable"></a>

### Nested Schema for `auth_scheme.environment_variable`

Required:

-   `variable_name` (String) Name of the environment variable that will store credentials.

<a id="nestedblock--auth_scheme--gcp_secrets_manager"></a>

### Nested Schema for `auth_scheme.gcp_secrets_manager`

Required:

-   `secret_name` (String) The unique identifier of the secret in GCP Secrets Manager.

<a id="nestedblock--auth_scheme--hashicorp_vault"></a>

### Nested Schema for `auth_scheme.hashicorp_vault`

Required:

-   `is_dynamic_user_account` (Boolean) Some Vault engines allow the dynamic creation of user accounts, meaning the username used to log in to the database may change from time to time.
-   `path` (String) The location in the Vault where the database username and password may be retrieved.

<a id="nestedblock--auth_scheme--kubernetes_secret"></a>

### Nested Schema for `auth_scheme.kubernetes_secret`

Required:

-   `secret_key` (String) The key of the credentials JSON blob within the secret.
-   `secret_name` (String) The unique identifier of the secret in Kubernetes.

<a id="nestedblock--approval_config"></a>

### Nested Schema for `approval_config`

Required:

-   `automatic_grant` (Boolean) If `true`, approvals can be automatically granted.
-   `max_auto_grant_duration` (String) The maximum duration in seconds for approvals can be automatically granted. E.g.: `"2000s"`, `"3000.5s"
