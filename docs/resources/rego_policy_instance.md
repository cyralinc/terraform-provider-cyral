# cyral_rego_policy_instance (Resource)

Manages a [Rego Policy](https://cyral.com/docs/policy/rego-policy/overview#) instance.

-> **Note** This resource can be used to create repo-level policies by specifying the repo IDs associated to the policy `scope`. For more information, see the [scope](#nestedblock--scope) field.

-> Import ID syntax is `{category}/{policy_id}`.

## Example Usage

```terraform
### Global rego policy instance
resource "cyral_rego_policy_instance" "policy" {
  name = "some-rate-limit-policy"
  category = "SECURITY"
  description = "Some policy description."
  template_id = "rate-limit"
  parameters = "{\"rateLimit\":7,\"labels\":[\"EMAIL\"],\"alertSeverity\":\"high\",\"block\":false}"
  enabled = true
  tags = ["tag1", "tag2"]
}

output "policy_last_updated" {
  value = cyral_rego_policy_instance.policy.last_updated
}

output "policy_created" {
  value = cyral_rego_policy_instance.policy.created
}

### Repo-level policy
resource "cyral_repository" "repo" {
  type = "mysql"
  name = "my_mysql"

  repo_node {
      host = "mysql.cyral.com"
      port = 3306
  }
}

resource "cyral_rego_policy_instance" "policy" {
  name = "some-data-masking-policy"
  category = "SECURITY"
  description = "Some policy description."
  template_id = "data-masking"
  parameters = "{\"labels\":[\"ADDRESS\"],\"maskType\":\"NULL_MASK\"}"
  enabled = true
  scope {
    repo_ids = [cyral_repository.repo.id]
  }
  tags = ["tag1", "tag2"]
}

### Rego policy instance with duration
resource "cyral_rego_policy_instance" "policy" {
  name = "some-data-masking-policy"
  category = "SECURITY"
  description = "Some policy description."
  template_id = "data-masking"
  parameters = "{\"labels\":[\"ADDRESS\"],\"maskType\":\"NULL_MASK\"}"
  enabled = true
  tags = ["tag1", "tag2"]
  duration = "10s"
}
```

<!-- schema generated by tfplugindocs -->

## Schema

### Required

- `category` (String) Policy category. List of supported categories:
  - `SECURITY`
  - `GRANT`
  - `USER_DEFINED`
- `name` (String) Policy name.
- `template_id` (String) Policy template identifier. Predefined templates are:
  - `data-firewall`
  - `data-masking`
  - `data-protection`
  - `EphemeralGrantPolicy`
  - `rate-limit`
  - `read-limit`
  - `repository-protection`
  - `service-account-abuse`
  - `user-segmentation`

### Optional

- `description` (String) Policy description.
- `duration` (String) Policy duration. The policy expires after the duration specified. Should follow the protobuf duration string format, which corresponds to a sequence of decimal numbers suffixed by a 's' at the end, representing the duration in seconds. For example: `300s`, `60s`, `10.50s` etc
- `enabled` (Boolean) Enable/disable the policy. Defaults to `false` (Disabled).
- `parameters` (String) Policy parameters. The parameters vary based on the policy template schema.
- `scope` (Block Set, Max: 1) Determines the scope that the policy applies to. It can be used to create a repo-level policy by specifying the corresponding `repo_ids` that this policy should be applied. (see [below for nested schema](#nestedblock--scope))
- `tags` (List of String) Tags that can be used to categorize the policy.

### Read-Only

- `created` (Set of Object) Information regarding the policy creation. (see [below for nested schema](#nestedatt--created))
- `id` (String) The resource identifier. It is a composed ID that follows the format `{category}/{policy_id}`.
- `last_updated` (Set of Object) Information regarding the policy last update. (see [below for nested schema](#nestedatt--last_updated))
- `policy_id` (String) ID of this rego policy instance in Cyral environment.

<a id="nestedblock--scope"></a>

### Nested Schema for `scope`

Required:

- `repo_ids` (List of String) A list of repository identifiers that belongs to the policy scope. The policy will be applied at repo-level for every repository ID included in this list. This is equivalent of creating a repo-level policy in the UI for a given repository.

<a id="nestedatt--created"></a>

### Nested Schema for `created`

Read-Only:

- `actor` (String)
- `actor_type` (String)
- `timestamp` (String)

<a id="nestedatt--last_updated"></a>

### Nested Schema for `last_updated`

Read-Only:

- `actor` (String)
- `actor_type` (String)
- `timestamp` (String)
